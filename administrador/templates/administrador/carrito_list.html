{% extends 'administrador/base_list.html' %}
{% load static %}

{% block title %}Carritos | Digit Soft{% endblock %}
{% block page_header %}Carritos{% endblock %}

{% block list_title %}Gestión de Carritos{% endblock %}
{% block list_description %}Administra los carritos de compra de los clientes{% endblock %}

{% block table_headers %}
<th>ID</th>
<th>Cliente</th>
<th>Total Items</th>
<th>Subtotal</th>
<th>Estado</th>
<th>Fecha Creación</th>
<th>Última Actualización</th>
<th style="width: 200px;">Acciones</th>
{% endblock %}

{% block table_body %}
{% if carritos %}
    {% for carrito in carritos %}
    <tr>
        <td><strong>#{{ carrito.id }}</strong></td>
        <td>{{ carrito.cliente.nombre_completo }}</td>
        <td>{{ carrito.total_items }}</td>
        <td>${{ carrito.subtotal|floatformat:2 }}</td>
        <td>
            {% if carrito.estado == 'ACTIVO' %}
                <span class="badge badge-success">{{ carrito.get_estado_display }}</span>
            {% elif carrito.estado == 'CONVERTIDO' %}
                <span class="badge badge-info">{{ carrito.get_estado_display }}</span>
            {% elif carrito.estado == 'ABANDONADO' %}
                <span class="badge badge-warning">{{ carrito.get_estado_display }}</span>
            {% else %}
                <span class="badge badge-danger">{{ carrito.get_estado_display }}</span>
            {% endif %}
        </td>
        <td>{{ carrito.fecha_creacion|date:"d/m/Y H:i" }}</td>
        <td>{{ carrito.fecha_actualizacion|date:"d/m/Y H:i" }}</td>
        <td>
            <div class="actions-cell">
                <button class="btn btn-info btn-sm" onclick="viewDetails({{ carrito.id }})" title="Ver detalles">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-success btn-sm" onclick="convertToSale({{ carrito.id }})" title="Convertir a venta">
                    <i class="fas fa-shopping-cart"></i>
                </button>
                <button class="btn btn-warning btn-sm" onclick="viewHistory({{ carrito.id }}, 'Carrito #{{ carrito.id }}')" title="Historial">
                    <i class="fas fa-history"></i>
                </button>
                <button class="btn btn-danger btn-sm" onclick="deleteRecord({{ carrito.id }}, 'Carrito #{{ carrito.id }}')" title="Eliminar">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
    </tr>
    {% endfor %}
{% else %}
    <tr>
        <td colspan="8" class="empty-state">
            <i class="fas fa-shopping-basket"></i>
            <p>No hay carritos registrados</p>
        </td>
    </tr>
{% endif %}
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
function convertToSale(carritoId) {
    if (confirm('¿Deseas convertir este carrito en una venta?')) {
        showNotification('Convirtiendo carrito a venta...', 'info');
        // Aquí iría la lógica para convertir el carrito
        setTimeout(() => {
            showNotification('Carrito convertido exitosamente', 'success');
        }, 1500);
    }
}
</script>
{% endblock %}

