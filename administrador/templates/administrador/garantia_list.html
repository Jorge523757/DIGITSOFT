{% extends 'administrador/base_list.html' %}
{% load static %}

{% block title %}Garantías | Digit Soft{% endblock %}
{% block page_header %}Garantías{% endblock %}

{% block list_title %}Gestión de Garantías{% endblock %}
{% block list_description %}Administra las garantías de productos y equipos{% endblock %}

{% block table_headers %}
<th>Número</th>
<th>Cliente</th>
<th>Producto/Equipo</th>
<th>Tipo</th>
<th>Inicio</th>
<th>Vencimiento</th>
<th>Duración</th>
<th>Estado</th>
<th style="width: 200px;">Acciones</th>
{% endblock %}

{% block table_body %}
{% if garantias %}
    {% for garantia in garantias %}
    <tr>
        <td><strong>{{ garantia.numero_garantia }}</strong></td>
        <td>{{ garantia.cliente.nombre_completo }}</td>
        <td>
            {% if garantia.producto %}
                {{ garantia.producto.nombre }}
            {% elif garantia.equipo %}
                {{ garantia.equipo.nombre }}
            {% else %}
                N/A
            {% endif %}
        </td>
        <td>
            <span class="badge badge-info">{{ garantia.get_tipo_garantia_display }}</span>
        </td>
        <td>{{ garantia.fecha_inicio|date:"d/m/Y" }}</td>
        <td>{{ garantia.fecha_vencimiento|date:"d/m/Y" }}</td>
        <td>{{ garantia.duracion_meses }} meses</td>
        <td>
            {% if garantia.esta_vigente %}
                <span class="badge badge-success">Vigente</span>
            {% elif garantia.estado == 'VENCIDA' %}
                <span class="badge badge-danger">{{ garantia.get_estado_display }}</span>
            {% elif garantia.estado == 'RECLAMADA' or garantia.estado == 'PROCESANDO' %}
                <span class="badge badge-warning">{{ garantia.get_estado_display }}</span>
            {% else %}
                <span class="badge badge-secondary">{{ garantia.get_estado_display }}</span>
            {% endif %}
        </td>
        <td>
            <div class="actions-cell">
                <button class="btn btn-info btn-sm" onclick="viewDetails({{ garantia.id }})" title="Ver detalles">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-primary btn-sm" onclick="editRecord({{ garantia.id }})" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-warning btn-sm" onclick="viewHistory({{ garantia.id }}, '{{ garantia.numero_garantia }}')" title="Historial">
                    <i class="fas fa-history"></i>
                </button>
                <button class="btn btn-danger btn-sm" onclick="deleteRecord({{ garantia.id }}, '{{ garantia.numero_garantia }}')" title="Eliminar">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
    </tr>
    {% endfor %}
{% else %}
    <tr>
        <td colspan="9" class="empty-state">
            <i class="fas fa-shield-alt"></i>
            <p>No hay garantías registradas</p>
            <button class="btn btn-primary" onclick="openModal('createModal')">
                <i class="fas fa-plus"></i> Registrar Primera Garantía
            </button>
        </td>
    </tr>
{% endif %}
{% endblock %}

{% block form_content %}
<div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
    <div class="form-group">
        <label class="form-label">Producto</label>
        <select name="producto" class="form-control">
            <option value="">Seleccione un producto...</option>
            {% for producto in productos %}
                <option value="{{ producto.id }}">{{ producto.nombre }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label class="form-label">Equipo</label>
        <select name="equipo" class="form-control">
            <option value="">Seleccione un equipo...</option>
            {% for equipo in equipos %}
                <option value="{{ equipo.id }}">{{ equipo.nombre }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<div class="form-group">
    <label class="form-label">Cliente *</label>
    <select name="cliente" class="form-control" required>
        <option value="">Seleccione un cliente...</option>
        {% for cliente in clientes %}
            <option value="{{ cliente.id }}">{{ cliente.nombre_completo }}</option>
        {% endfor %}
    </select>
</div>

<div class="form-group">
    <label class="form-label">Venta Relacionada</label>
    <select name="venta" class="form-control">
        <option value="">Seleccione una venta...</option>
        {% for venta in ventas %}
            <option value="{{ venta.id }}">{{ venta.numero_venta }}</option>
        {% endfor %}
    </select>
</div>

<div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
    <div class="form-group">
        <label class="form-label">Fecha de Inicio *</label>
        <input type="date" name="fecha_inicio" class="form-control" required>
    </div>
    <div class="form-group">
        <label class="form-label">Fecha de Vencimiento *</label>
        <input type="date" name="fecha_vencimiento" class="form-control" required>
    </div>
</div>

<div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
    <div class="form-group">
        <label class="form-label">Duración (meses) *</label>
        <input type="number" name="duracion_meses" class="form-control" required min="1" value="12">
    </div>
    <div class="form-group">
        <label class="form-label">Tipo de Garantía *</label>
        <select name="tipo_garantia" class="form-control" required>
            <option value="FABRICANTE">Garantía del Fabricante</option>
            <option value="DISTRIBUIDOR">Garantía del Distribuidor</option>
            <option value="TIENDA">Garantía de la Tienda</option>
            <option value="EXTENDIDA">Garantía Extendida</option>
        </select>
    </div>
</div>

<div class="form-group">
    <label class="form-label">Cobertura</label>
    <textarea name="cobertura" class="form-control" rows="3" placeholder="Describe qué cubre la garantía..."></textarea>
</div>

<div class="form-group">
    <label class="form-label">Condiciones</label>
    <textarea name="condiciones" class="form-control" rows="3" placeholder="Condiciones y términos de la garantía..."></textarea>
</div>
{% endblock %}

