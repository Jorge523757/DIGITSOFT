{% extends 'administrador/base_list.html' %}
{% load static %}

{% block title %}Ventas | Digit Soft{% endblock %}
{% block page_header %}Ventas{% endblock %}

{% block list_title %}Gestión de Ventas{% endblock %}
{% block list_description %}Administra las ventas y facturación{% endblock %}

{% block table_headers %}
<th>Número</th>
<th>Cliente</th>
<th>Fecha</th>
<th>Subtotal</th>
<th>Impuestos</th>
<th>Total</th>
<th>Método Pago</th>
<th>Estado</th>
<th style="width: 200px;">Acciones</th>
{% endblock %}

{% block table_body %}
{% if ventas %}
    {% for venta in ventas %}
    <tr>
        <td><strong>{{ venta.numero_venta }}</strong></td>
        <td>{{ venta.cliente.nombre_completo }}</td>
        <td>{{ venta.fecha_venta|date:"d/m/Y H:i" }}</td>
        <td>${{ venta.subtotal|floatformat:2 }}</td>
        <td>${{ venta.impuestos|floatformat:2 }}</td>
        <td><strong>${{ venta.total|floatformat:2 }}</strong></td>
        <td>
            <span class="badge badge-info">{{ venta.get_metodo_pago_display }}</span>
        </td>
        <td>
            {% if venta.estado == 'PAGADA' %}
                <span class="badge badge-success">{{ venta.get_estado_display }}</span>
            {% elif venta.estado == 'PENDIENTE' %}
                <span class="badge badge-warning">{{ venta.get_estado_display }}</span>
            {% else %}
                <span class="badge badge-danger">{{ venta.get_estado_display }}</span>
            {% endif %}
        </td>
        <td>
            <div class="actions-cell">
                <button class="btn btn-info btn-sm" onclick="viewDetails({{ venta.id }})" title="Ver detalles">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-primary btn-sm" onclick="editRecord({{ venta.id }})" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-warning btn-sm" onclick="viewHistory({{ venta.id }}, '{{ venta.numero_venta }}')" title="Historial">
                    <i class="fas fa-history"></i>
                </button>
                <button class="btn btn-danger btn-sm" onclick="deleteRecord({{ venta.id }}, '{{ venta.numero_venta }}')" title="Eliminar">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
    </tr>
    {% endfor %}
{% else %}
    <tr>
        <td colspan="9" class="empty-state">
            <i class="fas fa-shopping-cart"></i>
            <p>No hay ventas registradas</p>
            <button class="btn btn-primary" onclick="openModal('createModal')">
                <i class="fas fa-plus"></i> Agregar Primera Venta
            </button>
        </td>
    </tr>
{% endif %}
{% endblock %}

{% block form_content %}
<div class="form-group">
    <label class="form-label">Cliente *</label>
    <select name="cliente" class="form-control" required>
        <option value="">Seleccione un cliente...</option>
        {% for cliente in clientes %}
            <option value="{{ cliente.id }}">{{ cliente.nombre_completo }}</option>
        {% endfor %}
    </select>
</div>

<div class="form-group">
    <label class="form-label">Método de Pago *</label>
    <select name="metodo_pago" class="form-control" required>
        <option value="">Seleccione...</option>
        <option value="EFECTIVO">Efectivo</option>
        <option value="TARJETA_DEBITO">Tarjeta Débito</option>
        <option value="TARJETA_CREDITO">Tarjeta Crédito</option>
        <option value="TRANSFERENCIA">Transferencia</option>
        <option value="CREDITO">A Crédito</option>
        <option value="MIXTO">Mixto</option>
    </select>
</div>

<div class="form-group">
    <label class="form-label">Observaciones</label>
    <textarea name="observaciones" class="form-control" rows="3" placeholder="Observaciones adicionales (opcional)"></textarea>
</div>
{% endblock %}

